<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Sub Goal Overlay</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: transparent;
      overflow: hidden;
    }
    .wrapper {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }
    .number-group {
      display: flex;
      align-items: center;
    }

    /* Outer box defines visual width and overlap; inner img can be wide. */
    .digit {
      position: relative;
      width: 120px;
      height: 180px;
      margin: 0 -30px;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .digit img {
      height: 180px;
      width: auto;
    }

    /* Bring cane closer to numbers */
    .slash {
      height: 220px;
      margin: 0 40px;  /* was 80px; smaller = closer */
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <div class="number-group" id="current"></div>
    <img src="/img/candy-cane.png" class="slash" alt="/">
    <div class="number-group" id="goal"></div>
  </div>

  <script>
    async function fetchSubgoal() {
      const params = new URLSearchParams(window.location.search);
      const channel = params.get('channel') || '0pogix';

      try {
        const res = await fetch(`/api/subgoal?channel=${encodeURIComponent(channel)}`);
        const data = await res.json();
        renderNumber('current', String(data.current));
        renderNumber('goal', String(data.goal));
      } catch (err) {
        console.error('Failed to load subgoal', err);
      }
    }

    function renderNumber(containerId, value) {
      const container = document.getElementById(containerId);
      container.innerHTML = '';
      for (const ch of value) {
        const wrapper = document.createElement('div');
        wrapper.className = 'digit';

        const img = document.createElement('img');
        img.src = `/img/${ch}.png`;
        img.alt = ch;

        wrapper.appendChild(img);
        container.appendChild(wrapper);
      }
    }

    fetchSubgoal();
    setInterval(fetchSubgoal, 5000);
  </script>
</body>
</html>
